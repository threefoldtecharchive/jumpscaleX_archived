from Jumpscale import j

import pytest

from Jumpscale.clients.blockchain.tfchain.stub.ExplorerClientStub import TFChainExplorerGetClientStub


def main(self):
    """
    to run:

    kosmos 'j.clients.tfchain.test(name="atomicswap_refund")'
    """

    # create a tfchain client for devnet
    c = j.clients.tfchain.get("mytestclient", network_type="DEV")
    # or simply `c = j.tfchain.clients.mytestclient`, should the client already exist

    # (we replace internal client logic with custom logic as to ensure we can test without requiring an active network)
    explorer_client = TFChainExplorerGetClientStub()
    # add the blockchain info
    explorer_client.chain_info = '{"blockid":"5c180121d6dbbbc8480ee63d58933a4e0d9eae664c0b8662c3ef81102c3fe82c","difficulty":"23546","estimatedactivebs":"146","height":17384,"maturitytimestamp":1549705634,"target":[0,2,200,131,232,66,109,128,132,97,252,155,147,77,241,96,113,131,22,176,230,53,191,80,170,156,189,0,160,84,41,168],"totalcoins":"0","arbitrarydatatotalsize":4351,"minerpayoutcount":17470,"transactioncount":18011,"coininputcount":637,"coinoutputcount":1231,"blockstakeinputcount":17384,"blockstakeoutputcount":17385,"minerfeecount":626,"arbitrarydatacount":573}'
    explorer_client.hash_add(
        "5c180121d6dbbbc8480ee63d58933a4e0d9eae664c0b8662c3ef81102c3fe82c",
        '{"hashtype":"blockid","block":{"minerpayoutids":["c8f3f82e4c5be07c667f140456e188336dc5c86319260ad9964c1b2a553d7031"],"transactions":[{"id":"9d8823855c59ac903238849e2f31600a9bec2c27d36071402815046dbf8000e7","height":17384,"parent":"5c180121d6dbbbc8480ee63d58933a4e0d9eae664c0b8662c3ef81102c3fe82c","rawtransaction":{"version":1,"data":{"coininputs":null,"blockstakeinputs":[{"parentid":"7c111a656be26b42215d13df330aa46c30d9f84d8b47ca5f41c4a5a1f89c782d","fulfillment":{"type":1,"data":{"publickey":"ed25519:d285f92d6d449d9abb27f4c6cf82713cec0696d62b8c123f1627e054dc6d7780","signature":"8de764af61c2e404f246482a70e29881929a71e4644a4c6f3a620889b1339a3eb789b0e2b5dad4ba26d1862bbee3a62a6f42be8106867722488aed352b414d00"}}}],"blockstakeoutputs":[{"value":"3000","condition":{"type":1,"data":{"unlockhash":"015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"}}}],"minerfees":null}},"coininputoutputs":null,"coinoutputids":null,"coinoutputunlockhashes":null,"blockstakeinputoutputs":[{"value":"3000","condition":{"type":1,"data":{"unlockhash":"015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"}},"unlockhash":"015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"}],"blockstakeoutputids":["be4408fecfa7fb88831d6ff1ff2d32377c25ac6cdafcdec1a16644ef3540d0ea"],"blockstakeunlockhashes":["015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"],"unconfirmed":false}],"rawblock":{"parentid":"d329ebc493b75521db55b6595a7bfcbe5c1f94eb0ab1f7646bf39a42a8f7dddf","timestamp":1549705757,"pobsindexes":{"BlockHeight":17383,"TransactionIndex":0,"OutputIndex":0},"minerpayouts":[{"value":"10000000000","unlockhash":"015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"}],"transactions":[{"version":1,"data":{"coininputs":null,"blockstakeinputs":[{"parentid":"7c111a656be26b42215d13df330aa46c30d9f84d8b47ca5f41c4a5a1f89c782d","fulfillment":{"type":1,"data":{"publickey":"ed25519:d285f92d6d449d9abb27f4c6cf82713cec0696d62b8c123f1627e054dc6d7780","signature":"8de764af61c2e404f246482a70e29881929a71e4644a4c6f3a620889b1339a3eb789b0e2b5dad4ba26d1862bbee3a62a6f42be8106867722488aed352b414d00"}}}],"blockstakeoutputs":[{"value":"3000","condition":{"type":1,"data":{"unlockhash":"015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"}}}],"minerfees":null}}]},"blockid":"5c180121d6dbbbc8480ee63d58933a4e0d9eae664c0b8662c3ef81102c3fe82c","difficulty":"23546","estimatedactivebs":"146","height":17384,"maturitytimestamp":1549705634,"target":[0,2,200,131,232,66,109,128,132,97,252,155,147,77,241,96,113,131,22,176,230,53,191,80,170,156,189,0,160,84,41,168],"totalcoins":"0","arbitrarydatatotalsize":4351,"minerpayoutcount":17470,"transactioncount":18011,"coininputcount":637,"coinoutputcount":1231,"blockstakeinputcount":17384,"blockstakeoutputcount":17385,"minerfeecount":626,"arbitrarydatacount":573},"blocks":null,"transaction":{"id":"0000000000000000000000000000000000000000000000000000000000000000","height":0,"parent":"0000000000000000000000000000000000000000000000000000000000000000","rawtransaction":{"version":0,"data":{"coininputs":[],"minerfees":null}},"coininputoutputs":null,"coinoutputids":null,"coinoutputunlockhashes":null,"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false},"transactions":null,"multisigaddresses":null,"unconfirmed":false}',
    )
    # add the coin output info of the submitted atomic swap contract
    explorer_client.hash_add(
        "a5e0159688d300ed7a8f2685829192d8dd1266ce6e82a0d04a3bbbb080de30d0",
        '{"hashtype":"coinoutputid","block":{"minerpayoutids":null,"transactions":null,"rawblock":{"parentid":"0000000000000000000000000000000000000000000000000000000000000000","timestamp":0,"pobsindexes":{"BlockHeight":0,"TransactionIndex":0,"OutputIndex":0},"minerpayouts":null,"transactions":null},"blockid":"0000000000000000000000000000000000000000000000000000000000000000","difficulty":"0","estimatedactivebs":"0","height":0,"maturitytimestamp":0,"target":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"totalcoins":"0","arbitrarydatatotalsize":0,"minerpayoutcount":0,"transactioncount":0,"coininputcount":0,"coinoutputcount":0,"blockstakeinputcount":0,"blockstakeoutputcount":0,"minerfeecount":0,"arbitrarydatacount":0},"blocks":null,"transaction":{"id":"0000000000000000000000000000000000000000000000000000000000000000","height":0,"parent":"0000000000000000000000000000000000000000000000000000000000000000","rawtransaction":{"version":0,"data":{"coininputs":[],"minerfees":null}},"coininputoutputs":null,"coinoutputids":null,"coinoutputunlockhashes":null,"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false},"transactions":[{"id":"298b0a1d2da4ba13b3a787daea96da9e50ae6c299f6e3bea5ec3d50ee131c381","height":17740,"parent":"fa81bd33c4115e6a51f6f80107493a1b7e7591001d61948e88ef3cbb660e6fbe","rawtransaction":{"version":1,"data":{"coininputs":[{"parentid":"b0e64c6e9d0d6d515856e15fcdfd869721f5b14ffc7599204f1e6ec174fb3631","fulfillment":{"type":1,"data":{"publickey":"ed25519:e4f55bc46b5feb37c03a0faa2d624a9ee1d0deb5059aaa9625d8b4f60f29bcab","signature":"1137db84e433980d51d66524dba5eec1c622c58099b9a1608f47293e506fa5338a0cd2d2d068506aed7de2a702025d9f7ec639ab712a1b32417677d4ab7ad50f"}}}],"coinoutputs":[{"value":"20000000000","condition":{"type":2,"data":{"sender":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0","receiver":"0131cb8e9b5214096fd23c8d88795b2887fbc898aa37125a406fc4769a4f9b3c1dc423852868f6","hashedsecret":"2c9b9fda14a1319a9c391d1f87df0333f56cf6804222bfd7c29d03829e0fa3b0","timelock":1549710071}}},{"value":"28000000000","condition":{"type":1,"data":{"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}}}],"minerfees":["1000000000"],"arbitrarydata":"YSBjb250cmFjdCB0aGF0IGlzIG5vdCBhIGNvbnRyYWN0"}},"coininputoutputs":[{"value":"49000000000","condition":{"type":1,"data":{"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}},"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}],"coinoutputids":["a5e0159688d300ed7a8f2685829192d8dd1266ce6e82a0d04a3bbbb080de30d0","deb0edcd4f4971819dd07aff0ff5565a53cd939f71f0a44d43f1deac1721dcc6"],"coinoutputunlockhashes":["025e64af6ec54312135ede1140e774da2ecadc9b2fb7ed8c0a7077035463d5049350c141597527","01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"],"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false}],"multisigaddresses":null,"unconfirmed":false}',
    )
    # add initial wallet info
    explorer_client.hash_add(
        "01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0",
        '{"hashtype":"unlockhash","block":{"minerpayoutids":null,"transactions":null,"rawblock":{"parentid":"0000000000000000000000000000000000000000000000000000000000000000","timestamp":0,"pobsindexes":{"BlockHeight":0,"TransactionIndex":0,"OutputIndex":0},"minerpayouts":null,"transactions":null},"blockid":"0000000000000000000000000000000000000000000000000000000000000000","difficulty":"0","estimatedactivebs":"0","height":0,"maturitytimestamp":0,"target":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"totalcoins":"0","arbitrarydatatotalsize":0,"minerpayoutcount":0,"transactioncount":0,"coininputcount":0,"coinoutputcount":0,"blockstakeinputcount":0,"blockstakeoutputcount":0,"minerfeecount":0,"arbitrarydatacount":0},"blocks":null,"transaction":{"id":"0000000000000000000000000000000000000000000000000000000000000000","height":0,"parent":"0000000000000000000000000000000000000000000000000000000000000000","rawtransaction":{"version":0,"data":{"coininputs":[],"minerfees":null}},"coininputoutputs":null,"coinoutputids":null,"coinoutputunlockhashes":null,"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false},"transactions":[{"id":"298b0a1d2da4ba13b3a787daea96da9e50ae6c299f6e3bea5ec3d50ee131c381","height":17740,"parent":"fa81bd33c4115e6a51f6f80107493a1b7e7591001d61948e88ef3cbb660e6fbe","rawtransaction":{"version":1,"data":{"coininputs":[{"parentid":"b0e64c6e9d0d6d515856e15fcdfd869721f5b14ffc7599204f1e6ec174fb3631","fulfillment":{"type":1,"data":{"publickey":"ed25519:e4f55bc46b5feb37c03a0faa2d624a9ee1d0deb5059aaa9625d8b4f60f29bcab","signature":"1137db84e433980d51d66524dba5eec1c622c58099b9a1608f47293e506fa5338a0cd2d2d068506aed7de2a702025d9f7ec639ab712a1b32417677d4ab7ad50f"}}}],"coinoutputs":[{"value":"20000000000","condition":{"type":2,"data":{"sender":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0","receiver":"0131cb8e9b5214096fd23c8d88795b2887fbc898aa37125a406fc4769a4f9b3c1dc423852868f6","hashedsecret":"2c9b9fda14a1319a9c391d1f87df0333f56cf6804222bfd7c29d03829e0fa3b0","timelock":1549710071}}},{"value":"28000000000","condition":{"type":1,"data":{"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}}}],"minerfees":["1000000000"],"arbitrarydata":"YSBjb250cmFjdCB0aGF0IGlzIG5vdCBhIGNvbnRyYWN0"}},"coininputoutputs":[{"value":"49000000000","condition":{"type":1,"data":{"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}},"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}],"coinoutputids":["a5e0159688d300ed7a8f2685829192d8dd1266ce6e82a0d04a3bbbb080de30d0","deb0edcd4f4971819dd07aff0ff5565a53cd939f71f0a44d43f1deac1721dcc6"],"coinoutputunlockhashes":["025e64af6ec54312135ede1140e774da2ecadc9b2fb7ed8c0a7077035463d5049350c141597527","01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"],"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false},{"id":"4a7ac7930379675c82d0462a86e6d6f4018bdb2bdabaf49f4c177b8de19b4e7c","height":16930,"parent":"c25f345403080b8372a38f66608aa5a2287bdc61b82efe5ee6503ce85e8bcd35","rawtransaction":{"version":1,"data":{"coininputs":[{"parentid":"753aaeaa0c9e6c9f1f8da1974c83d8ca067ad536f464a2e2fc038bbd0404d084","fulfillment":{"type":1,"data":{"publickey":"ed25519:e4f55bc46b5feb37c03a0faa2d624a9ee1d0deb5059aaa9625d8b4f60f29bcab","signature":"b5081e41797f53233c727c344698400a73f2cdd364e241df915df413d3eeafb425ce9b51de3731bcbf830c399a706f4d24ae7066f947a4a36ae1b25415bcde00"}}}],"coinoutputs":[{"value":"50000000000","condition":{"type":2,"data":{"sender":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0","receiver":"01746b199781ea316a44183726f81e0734d93e7cefc18e9a913989821100aafa33e6eb7343fa8c","hashedsecret":"4163d4b31a1708cd3bb95a0a8117417bdde69fd1132909f92a8ec1e3fe2ccdba","timelock":1549736249}}}],"minerfees":["1000000000"]}},"coininputoutputs":[{"value":"51000000000","condition":{"type":1,"data":{"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}},"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}],"coinoutputids":["023b1c17a01945573933e62ca7a1297057681622aaea52c4c4e198077a263890"],"coinoutputunlockhashes":["02fb27c67c373c2f30611e0b98bf92ed6e6eb0a69b471457b282903945180cd5c5b8068731f767"],"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false},{"id":"b147985d381bc626ef79219ca988b5b1e2d328ade10cd7f3d48b96ca67928155","height":17698,"parent":"e8656ff72f9288c9ece3f85e489389f3c77e84052db13702b03dcff266a4d844","rawtransaction":{"version":1,"data":{"coininputs":[{"parentid":"dd1babcbab492c742983b887a7408742ad0054ec8586541dd6ee6202877cb486","fulfillment":{"type":2,"data":{"publickey":"ed25519:e4f55bc46b5feb37c03a0faa2d624a9ee1d0deb5059aaa9625d8b4f60f29bcab","signature":"4a7a15125f4e8819b4cf57dfe5f0389f45b0779b2a4bf27d885b4de8659ad363eb5be8c38ec88b33fc6fe1d18c55a9c0220f21977d36d1c8f63d582c8c126b0d","secret":"f68d8b238c193bc6765b8e355c53e4f574a2c9da458e55d4402edca621e53756"}}}],"coinoutputs":[{"value":"49000000000","condition":{"type":1,"data":{"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}}}],"minerfees":["1000000000"]}},"coininputoutputs":[{"value":"50000000000","condition":{"type":2,"data":{"sender":"01b88206a3300dea3dd5f6cd73568ac5797b078910c78cbce6a71fcd0837a3ea5a4f2ed9fc70a1","receiver":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0","hashedsecret":"e24b6b609b351a958982ba91de7624d3503f428620f5586fbea1f71807b545c1","timelock":1549878527}},"unlockhash":"02f6d25603d232512ade46cdec3160301d8bd4880f2d4e8e20f54aff24f94dac5792ab1b325c3d"}],"coinoutputids":["b0e64c6e9d0d6d515856e15fcdfd869721f5b14ffc7599204f1e6ec174fb3631"],"coinoutputunlockhashes":["01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"],"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false},{"id":"bca044302e018e67600bd0bd3223ae8dbb702eb528e73d6cfa9d057d4f73b03a","height":16911,"parent":"b4882a0b8632396a9c5d83a5c8684ab76736f4bff6d971795ed7334fac8aa339","rawtransaction":{"version":1,"data":{"coininputs":[{"parentid":"357451c3f3a15f6150aedede9d5228ec5dfc2d32c9b62c2a46128533a7845c72","fulfillment":{"type":1,"data":{"publickey":"ed25519:fdb2e1b898dda304f748c0ff812a24729b2aafd344512079ab778eb368b18645","signature":"bd9dd36e86c08a5990ad5282d1079705c3a4b1cf3896e96791aa7db97002d5eb002c50467f45bd3ac1086292932cd2ab53c91b2e8bb74b9d9c9c0d558082ef08"}}}],"coinoutputs":[{"value":"51000000000","condition":{"type":1,"data":{"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}}},{"value":"99994187000000000","condition":{"type":1,"data":{"unlockhash":"0183841ae8952a2ba72db0d6fce6208df70f2a936ee589ff852e06b20af48b40489572b1a69b2a"}}}],"minerfees":["1000000000"]}},"coininputoutputs":[{"value":"99994239000000000","condition":{"type":1,"data":{"unlockhash":"019bb005b78a47fd084f4f3a088d83da4fadfc8e494ce4dae0d6f70a048a0a745d88ace6ce6f1c"}},"unlockhash":"019bb005b78a47fd084f4f3a088d83da4fadfc8e494ce4dae0d6f70a048a0a745d88ace6ce6f1c"}],"coinoutputids":["753aaeaa0c9e6c9f1f8da1974c83d8ca067ad536f464a2e2fc038bbd0404d084","8c8dbd70c6eb2d5d181aa5ae430f2cc86e038b92e45dd6f6d5a28400efad4511"],"coinoutputunlockhashes":["01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0","0183841ae8952a2ba72db0d6fce6208df70f2a936ee589ff852e06b20af48b40489572b1a69b2a"],"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false}],"multisigaddresses":null,"unconfirmed":false}',
    )
    # override internal functionality, as to use our stub client
    c._explorer_get = explorer_client.explorer_get
    c._explorer_post = explorer_client.explorer_post

    # a wallet is required to redeem a contract
    w = c.wallets.new(
        "mytestwallet",
        seed="remain solar kangaroo welcome clean object friend later bounce strong ship lift hamster afraid you super dolphin warm emotion curve smooth kiss stem diet",
    )

    # balance should be 0 at this point
    assert w.balance.available == "28 TFT"

    # if the output identifier is wrong, the refund will fail
    with pytest.raises(j.clients.tfchain.errors.AtomicSwapContractNotFound):
        w.atomicswap.refund("a5e0159688d300ed7a8f2685829192d8dd1266ce6e82a0d04a3bbbb080de30d5")

    # if not authorized, refund will also fail
    fw = c.wallets.new("foo")
    with pytest.raises(j.clients.tfchain.errors.AtomicSwapForbidden):
        fw.atomicswap.refund("a5e0159688d300ed7a8f2685829192d8dd1266ce6e82a0d04a3bbbb080de30d0")

    # if not refundable yet, refund will still fail
    with pytest.raises(j.clients.tfchain.errors.AtomicSwapForbidden):
        w.atomicswap.refund("a5e0159688d300ed7a8f2685829192d8dd1266ce6e82a0d04a3bbbb080de30d0")

    # if the blockchain is updated, and the time for refund has reached, things will become possible
    explorer_client.chain_info = '{"blockid":"325adb8b1198071b0873fdf3cd14c2090ab41b1ddf04556929513ac9b993de00","difficulty":"25314","estimatedactivebs":"2473","height":17776,"maturitytimestamp":1549710377,"target":[0,2,150,191,242,114,194,147,165,155,81,115,131,110,151,69,195,82,72,171,51,207,157,226,142,254,6,122,72,56,5,109],"totalcoins":"0","arbitrarydatatotalsize":4384,"minerpayoutcount":17864,"transactioncount":18405,"coininputcount":639,"coinoutputcount":1234,"blockstakeinputcount":17776,"blockstakeoutputcount":17777,"minerfeecount":628,"arbitrarydatacount":574}'
    explorer_client.hash_add(
        "325adb8b1198071b0873fdf3cd14c2090ab41b1ddf04556929513ac9b993de00",
        '{"hashtype":"blockid","block":{"minerpayoutids":["4c506e8cf50539ebd988de20892166f8aca71038e47817e5881dfbb7b5a72d1f"],"transactions":[{"id":"e28f35ab114ba22a889b2cd7027333fc4689b2b0dde5fd459614805f0eed2677","height":17776,"parent":"325adb8b1198071b0873fdf3cd14c2090ab41b1ddf04556929513ac9b993de00","rawtransaction":{"version":1,"data":{"coininputs":null,"blockstakeinputs":[{"parentid":"9827b96889c6f6e97cfea0f44602b5e4a5ce53f6769a5d8d7153348836708fba","fulfillment":{"type":1,"data":{"publickey":"ed25519:d285f92d6d449d9abb27f4c6cf82713cec0696d62b8c123f1627e054dc6d7780","signature":"51abf8ae9cf011cc9c630fb64482214a4fea5928282192ee75c597e5db415b10bbd06c276a41c45d0b20b692093ceb6afd9014b31828cbc64a68e9ae533e260a"}}}],"blockstakeoutputs":[{"value":"3000","condition":{"type":1,"data":{"unlockhash":"015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"}}}],"minerfees":null}},"coininputoutputs":null,"coinoutputids":null,"coinoutputunlockhashes":null,"blockstakeinputoutputs":[{"value":"3000","condition":{"type":1,"data":{"unlockhash":"015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"}},"unlockhash":"015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"}],"blockstakeoutputids":["79ccce665ca8bfc1c277418ebfc2c488cd545469fcdaff009edee9ac32fcb747"],"blockstakeunlockhashes":["015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"],"unconfirmed":false}],"rawblock":{"parentid":"7651b16bcf6c0672a212c1846a142888b3beb1087cdc72c2c45d9c49ab55b890","timestamp":1549710522,"pobsindexes":{"BlockHeight":17775,"TransactionIndex":0,"OutputIndex":0},"minerpayouts":[{"value":"10000000000","unlockhash":"015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"}],"transactions":[{"version":1,"data":{"coininputs":null,"blockstakeinputs":[{"parentid":"9827b96889c6f6e97cfea0f44602b5e4a5ce53f6769a5d8d7153348836708fba","fulfillment":{"type":1,"data":{"publickey":"ed25519:d285f92d6d449d9abb27f4c6cf82713cec0696d62b8c123f1627e054dc6d7780","signature":"51abf8ae9cf011cc9c630fb64482214a4fea5928282192ee75c597e5db415b10bbd06c276a41c45d0b20b692093ceb6afd9014b31828cbc64a68e9ae533e260a"}}}],"blockstakeoutputs":[{"value":"3000","condition":{"type":1,"data":{"unlockhash":"015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"}}}],"minerfees":null}}]},"blockid":"325adb8b1198071b0873fdf3cd14c2090ab41b1ddf04556929513ac9b993de00","difficulty":"25314","estimatedactivebs":"2473","height":17776,"maturitytimestamp":1549710377,"target":[0,2,150,191,242,114,194,147,165,155,81,115,131,110,151,69,195,82,72,171,51,207,157,226,142,254,6,122,72,56,5,109],"totalcoins":"0","arbitrarydatatotalsize":4384,"minerpayoutcount":17864,"transactioncount":18405,"coininputcount":639,"coinoutputcount":1234,"blockstakeinputcount":17776,"blockstakeoutputcount":17777,"minerfeecount":628,"arbitrarydatacount":574},"blocks":null,"transaction":{"id":"0000000000000000000000000000000000000000000000000000000000000000","height":0,"parent":"0000000000000000000000000000000000000000000000000000000000000000","rawtransaction":{"version":0,"data":{"coininputs":[],"minerfees":null}},"coininputoutputs":null,"coinoutputids":null,"coinoutputunlockhashes":null,"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false},"transactions":null,"multisigaddresses":null,"unconfirmed":false}',
    )

    # once the contract can be refunded and you are authorized to refund the contract,
    # you can refund the atomic swap contract as follows:
    w.atomicswap.refund("a5e0159688d300ed7a8f2685829192d8dd1266ce6e82a0d04a3bbbb080de30d0")

    # once it becomes registered on the chain
    explorer_client.hash_add(
        "a5e0159688d300ed7a8f2685829192d8dd1266ce6e82a0d04a3bbbb080de30d0",
        '{"hashtype":"coinoutputid","block":{"minerpayoutids":null,"transactions":null,"rawblock":{"parentid":"0000000000000000000000000000000000000000000000000000000000000000","timestamp":0,"pobsindexes":{"BlockHeight":0,"TransactionIndex":0,"OutputIndex":0},"minerpayouts":null,"transactions":null},"blockid":"0000000000000000000000000000000000000000000000000000000000000000","difficulty":"0","estimatedactivebs":"0","height":0,"maturitytimestamp":0,"target":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"totalcoins":"0","arbitrarydatatotalsize":0,"minerpayoutcount":0,"transactioncount":0,"coininputcount":0,"coinoutputcount":0,"blockstakeinputcount":0,"blockstakeoutputcount":0,"minerfeecount":0,"arbitrarydatacount":0},"blocks":null,"transaction":{"id":"0000000000000000000000000000000000000000000000000000000000000000","height":0,"parent":"0000000000000000000000000000000000000000000000000000000000000000","rawtransaction":{"version":0,"data":{"coininputs":[],"minerfees":null}},"coininputoutputs":null,"coinoutputids":null,"coinoutputunlockhashes":null,"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false},"transactions":[{"id":"298b0a1d2da4ba13b3a787daea96da9e50ae6c299f6e3bea5ec3d50ee131c381","height":17740,"parent":"fa81bd33c4115e6a51f6f80107493a1b7e7591001d61948e88ef3cbb660e6fbe","rawtransaction":{"version":1,"data":{"coininputs":[{"parentid":"b0e64c6e9d0d6d515856e15fcdfd869721f5b14ffc7599204f1e6ec174fb3631","fulfillment":{"type":1,"data":{"publickey":"ed25519:e4f55bc46b5feb37c03a0faa2d624a9ee1d0deb5059aaa9625d8b4f60f29bcab","signature":"1137db84e433980d51d66524dba5eec1c622c58099b9a1608f47293e506fa5338a0cd2d2d068506aed7de2a702025d9f7ec639ab712a1b32417677d4ab7ad50f"}}}],"coinoutputs":[{"value":"20000000000","condition":{"type":2,"data":{"sender":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0","receiver":"0131cb8e9b5214096fd23c8d88795b2887fbc898aa37125a406fc4769a4f9b3c1dc423852868f6","hashedsecret":"2c9b9fda14a1319a9c391d1f87df0333f56cf6804222bfd7c29d03829e0fa3b0","timelock":1549710071}}},{"value":"28000000000","condition":{"type":1,"data":{"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}}}],"minerfees":["1000000000"],"arbitrarydata":"YSBjb250cmFjdCB0aGF0IGlzIG5vdCBhIGNvbnRyYWN0"}},"coininputoutputs":[{"value":"49000000000","condition":{"type":1,"data":{"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}},"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}],"coinoutputids":["a5e0159688d300ed7a8f2685829192d8dd1266ce6e82a0d04a3bbbb080de30d0","deb0edcd4f4971819dd07aff0ff5565a53cd939f71f0a44d43f1deac1721dcc6"],"coinoutputunlockhashes":["025e64af6ec54312135ede1140e774da2ecadc9b2fb7ed8c0a7077035463d5049350c141597527","01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"],"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false},{"id":"e9a909b0198328b38da003c31571d26eb6a0df35c31eee7fd087bc6ffcfd3501","height":17821,"parent":"c92c56e9520c63d7cb3061319eaf46d22e69e7f93d73ea73596d8651a7834fa2","rawtransaction":{"version":1,"data":{"coininputs":[{"parentid":"a5e0159688d300ed7a8f2685829192d8dd1266ce6e82a0d04a3bbbb080de30d0","fulfillment":{"type":2,"data":{"publickey":"ed25519:e4f55bc46b5feb37c03a0faa2d624a9ee1d0deb5059aaa9625d8b4f60f29bcab","signature":"b2d98b7d6e3c3634ed1f9fb992ac4f1bfa844126d8addac8ee764ef995a656b064c674803c646fba6c7201bf0f16c44b36c0e45702cc9e66fc5ed73934eadd09","secret":"0000000000000000000000000000000000000000000000000000000000000000"}}}],"coinoutputs":[{"value":"19000000000","condition":{"type":1,"data":{"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}}}],"minerfees":["1000000000"]}},"coininputoutputs":[{"value":"20000000000","condition":{"type":2,"data":{"sender":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0","receiver":"0131cb8e9b5214096fd23c8d88795b2887fbc898aa37125a406fc4769a4f9b3c1dc423852868f6","hashedsecret":"2c9b9fda14a1319a9c391d1f87df0333f56cf6804222bfd7c29d03829e0fa3b0","timelock":1549710071}},"unlockhash":"025e64af6ec54312135ede1140e774da2ecadc9b2fb7ed8c0a7077035463d5049350c141597527"}],"coinoutputids":["4a3602e082b5038f72254976ec9a833300e0a87571a4956b33faf126198e579a"],"coinoutputunlockhashes":["01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"],"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false}],"multisigaddresses":null,"unconfirmed":false}',
        force=True,
    )
    explorer_client.hash_add(
        "01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0",
        '{"hashtype":"unlockhash","block":{"minerpayoutids":null,"transactions":null,"rawblock":{"parentid":"0000000000000000000000000000000000000000000000000000000000000000","timestamp":0,"pobsindexes":{"BlockHeight":0,"TransactionIndex":0,"OutputIndex":0},"minerpayouts":null,"transactions":null},"blockid":"0000000000000000000000000000000000000000000000000000000000000000","difficulty":"0","estimatedactivebs":"0","height":0,"maturitytimestamp":0,"target":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"totalcoins":"0","arbitrarydatatotalsize":0,"minerpayoutcount":0,"transactioncount":0,"coininputcount":0,"coinoutputcount":0,"blockstakeinputcount":0,"blockstakeoutputcount":0,"minerfeecount":0,"arbitrarydatacount":0},"blocks":null,"transaction":{"id":"0000000000000000000000000000000000000000000000000000000000000000","height":0,"parent":"0000000000000000000000000000000000000000000000000000000000000000","rawtransaction":{"version":0,"data":{"coininputs":[],"minerfees":null}},"coininputoutputs":null,"coinoutputids":null,"coinoutputunlockhashes":null,"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false},"transactions":[{"id":"298b0a1d2da4ba13b3a787daea96da9e50ae6c299f6e3bea5ec3d50ee131c381","height":17740,"parent":"fa81bd33c4115e6a51f6f80107493a1b7e7591001d61948e88ef3cbb660e6fbe","rawtransaction":{"version":1,"data":{"coininputs":[{"parentid":"b0e64c6e9d0d6d515856e15fcdfd869721f5b14ffc7599204f1e6ec174fb3631","fulfillment":{"type":1,"data":{"publickey":"ed25519:e4f55bc46b5feb37c03a0faa2d624a9ee1d0deb5059aaa9625d8b4f60f29bcab","signature":"1137db84e433980d51d66524dba5eec1c622c58099b9a1608f47293e506fa5338a0cd2d2d068506aed7de2a702025d9f7ec639ab712a1b32417677d4ab7ad50f"}}}],"coinoutputs":[{"value":"20000000000","condition":{"type":2,"data":{"sender":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0","receiver":"0131cb8e9b5214096fd23c8d88795b2887fbc898aa37125a406fc4769a4f9b3c1dc423852868f6","hashedsecret":"2c9b9fda14a1319a9c391d1f87df0333f56cf6804222bfd7c29d03829e0fa3b0","timelock":1549710071}}},{"value":"28000000000","condition":{"type":1,"data":{"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}}}],"minerfees":["1000000000"],"arbitrarydata":"YSBjb250cmFjdCB0aGF0IGlzIG5vdCBhIGNvbnRyYWN0"}},"coininputoutputs":[{"value":"49000000000","condition":{"type":1,"data":{"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}},"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}],"coinoutputids":["a5e0159688d300ed7a8f2685829192d8dd1266ce6e82a0d04a3bbbb080de30d0","deb0edcd4f4971819dd07aff0ff5565a53cd939f71f0a44d43f1deac1721dcc6"],"coinoutputunlockhashes":["025e64af6ec54312135ede1140e774da2ecadc9b2fb7ed8c0a7077035463d5049350c141597527","01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"],"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false},{"id":"4a7ac7930379675c82d0462a86e6d6f4018bdb2bdabaf49f4c177b8de19b4e7c","height":16930,"parent":"c25f345403080b8372a38f66608aa5a2287bdc61b82efe5ee6503ce85e8bcd35","rawtransaction":{"version":1,"data":{"coininputs":[{"parentid":"753aaeaa0c9e6c9f1f8da1974c83d8ca067ad536f464a2e2fc038bbd0404d084","fulfillment":{"type":1,"data":{"publickey":"ed25519:e4f55bc46b5feb37c03a0faa2d624a9ee1d0deb5059aaa9625d8b4f60f29bcab","signature":"b5081e41797f53233c727c344698400a73f2cdd364e241df915df413d3eeafb425ce9b51de3731bcbf830c399a706f4d24ae7066f947a4a36ae1b25415bcde00"}}}],"coinoutputs":[{"value":"50000000000","condition":{"type":2,"data":{"sender":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0","receiver":"01746b199781ea316a44183726f81e0734d93e7cefc18e9a913989821100aafa33e6eb7343fa8c","hashedsecret":"4163d4b31a1708cd3bb95a0a8117417bdde69fd1132909f92a8ec1e3fe2ccdba","timelock":1549736249}}}],"minerfees":["1000000000"]}},"coininputoutputs":[{"value":"51000000000","condition":{"type":1,"data":{"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}},"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}],"coinoutputids":["023b1c17a01945573933e62ca7a1297057681622aaea52c4c4e198077a263890"],"coinoutputunlockhashes":["02fb27c67c373c2f30611e0b98bf92ed6e6eb0a69b471457b282903945180cd5c5b8068731f767"],"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false},{"id":"b147985d381bc626ef79219ca988b5b1e2d328ade10cd7f3d48b96ca67928155","height":17698,"parent":"e8656ff72f9288c9ece3f85e489389f3c77e84052db13702b03dcff266a4d844","rawtransaction":{"version":1,"data":{"coininputs":[{"parentid":"dd1babcbab492c742983b887a7408742ad0054ec8586541dd6ee6202877cb486","fulfillment":{"type":2,"data":{"publickey":"ed25519:e4f55bc46b5feb37c03a0faa2d624a9ee1d0deb5059aaa9625d8b4f60f29bcab","signature":"4a7a15125f4e8819b4cf57dfe5f0389f45b0779b2a4bf27d885b4de8659ad363eb5be8c38ec88b33fc6fe1d18c55a9c0220f21977d36d1c8f63d582c8c126b0d","secret":"f68d8b238c193bc6765b8e355c53e4f574a2c9da458e55d4402edca621e53756"}}}],"coinoutputs":[{"value":"49000000000","condition":{"type":1,"data":{"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}}}],"minerfees":["1000000000"]}},"coininputoutputs":[{"value":"50000000000","condition":{"type":2,"data":{"sender":"01b88206a3300dea3dd5f6cd73568ac5797b078910c78cbce6a71fcd0837a3ea5a4f2ed9fc70a1","receiver":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0","hashedsecret":"e24b6b609b351a958982ba91de7624d3503f428620f5586fbea1f71807b545c1","timelock":1549878527}},"unlockhash":"02f6d25603d232512ade46cdec3160301d8bd4880f2d4e8e20f54aff24f94dac5792ab1b325c3d"}],"coinoutputids":["b0e64c6e9d0d6d515856e15fcdfd869721f5b14ffc7599204f1e6ec174fb3631"],"coinoutputunlockhashes":["01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"],"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false},{"id":"bca044302e018e67600bd0bd3223ae8dbb702eb528e73d6cfa9d057d4f73b03a","height":16911,"parent":"b4882a0b8632396a9c5d83a5c8684ab76736f4bff6d971795ed7334fac8aa339","rawtransaction":{"version":1,"data":{"coininputs":[{"parentid":"357451c3f3a15f6150aedede9d5228ec5dfc2d32c9b62c2a46128533a7845c72","fulfillment":{"type":1,"data":{"publickey":"ed25519:fdb2e1b898dda304f748c0ff812a24729b2aafd344512079ab778eb368b18645","signature":"bd9dd36e86c08a5990ad5282d1079705c3a4b1cf3896e96791aa7db97002d5eb002c50467f45bd3ac1086292932cd2ab53c91b2e8bb74b9d9c9c0d558082ef08"}}}],"coinoutputs":[{"value":"51000000000","condition":{"type":1,"data":{"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}}},{"value":"99994187000000000","condition":{"type":1,"data":{"unlockhash":"0183841ae8952a2ba72db0d6fce6208df70f2a936ee589ff852e06b20af48b40489572b1a69b2a"}}}],"minerfees":["1000000000"]}},"coininputoutputs":[{"value":"99994239000000000","condition":{"type":1,"data":{"unlockhash":"019bb005b78a47fd084f4f3a088d83da4fadfc8e494ce4dae0d6f70a048a0a745d88ace6ce6f1c"}},"unlockhash":"019bb005b78a47fd084f4f3a088d83da4fadfc8e494ce4dae0d6f70a048a0a745d88ace6ce6f1c"}],"coinoutputids":["753aaeaa0c9e6c9f1f8da1974c83d8ca067ad536f464a2e2fc038bbd0404d084","8c8dbd70c6eb2d5d181aa5ae430f2cc86e038b92e45dd6f6d5a28400efad4511"],"coinoutputunlockhashes":["01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0","0183841ae8952a2ba72db0d6fce6208df70f2a936ee589ff852e06b20af48b40489572b1a69b2a"],"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false},{"id":"e9a909b0198328b38da003c31571d26eb6a0df35c31eee7fd087bc6ffcfd3501","height":17821,"parent":"c92c56e9520c63d7cb3061319eaf46d22e69e7f93d73ea73596d8651a7834fa2","rawtransaction":{"version":1,"data":{"coininputs":[{"parentid":"a5e0159688d300ed7a8f2685829192d8dd1266ce6e82a0d04a3bbbb080de30d0","fulfillment":{"type":2,"data":{"publickey":"ed25519:e4f55bc46b5feb37c03a0faa2d624a9ee1d0deb5059aaa9625d8b4f60f29bcab","signature":"b2d98b7d6e3c3634ed1f9fb992ac4f1bfa844126d8addac8ee764ef995a656b064c674803c646fba6c7201bf0f16c44b36c0e45702cc9e66fc5ed73934eadd09","secret":"0000000000000000000000000000000000000000000000000000000000000000"}}}],"coinoutputs":[{"value":"19000000000","condition":{"type":1,"data":{"unlockhash":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"}}}],"minerfees":["1000000000"]}},"coininputoutputs":[{"value":"20000000000","condition":{"type":2,"data":{"sender":"01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0","receiver":"0131cb8e9b5214096fd23c8d88795b2887fbc898aa37125a406fc4769a4f9b3c1dc423852868f6","hashedsecret":"2c9b9fda14a1319a9c391d1f87df0333f56cf6804222bfd7c29d03829e0fa3b0","timelock":1549710071}},"unlockhash":"025e64af6ec54312135ede1140e774da2ecadc9b2fb7ed8c0a7077035463d5049350c141597527"}],"coinoutputids":["4a3602e082b5038f72254976ec9a833300e0a87571a4956b33faf126198e579a"],"coinoutputunlockhashes":["01b73c4e869b6167abe6180ebe7a907f56e0357b4a2f65eb53d22baad84650eb62fce66ba036d0"],"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false}],"multisigaddresses":null,"unconfirmed":false}',
        force=True,
    )
    explorer_client.chain_info = '{"blockid":"e7113d9220ed1d2b9580db56900275a84cae37f4a05d114f7c2e390e5548a748","difficulty":"16357","estimatedactivebs":"2062","height":17826,"maturitytimestamp":1549711238,"target":[0,4,1,160,229,117,42,154,91,220,26,179,144,72,8,24,83,164,54,113,254,108,169,110,240,86,243,41,58,188,99,94],"totalcoins":"0","arbitrarydatatotalsize":4384,"minerpayoutcount":17915,"transactioncount":18456,"coininputcount":640,"coinoutputcount":1235,"blockstakeinputcount":17826,"blockstakeoutputcount":17827,"minerfeecount":629,"arbitrarydatacount":574}'
    explorer_client.hash_add(
        "e7113d9220ed1d2b9580db56900275a84cae37f4a05d114f7c2e390e5548a748",
        '{"hashtype":"blockid","block":{"minerpayoutids":["dbddb3ae78bd05ae1673eb3dcd13bd9df54dd0e9fead56311cb53aeca4e8fff7"],"transactions":[{"id":"568969fac665b480b364f50c42920019e27c194ed876b36093bb3a5456b99f48","height":17826,"parent":"e7113d9220ed1d2b9580db56900275a84cae37f4a05d114f7c2e390e5548a748","rawtransaction":{"version":1,"data":{"coininputs":null,"blockstakeinputs":[{"parentid":"efebc1649846007eacab3d119cd42daed8a240da8f9ebd31f2472df442467adb","fulfillment":{"type":1,"data":{"publickey":"ed25519:d285f92d6d449d9abb27f4c6cf82713cec0696d62b8c123f1627e054dc6d7780","signature":"28012952f77113862a48698af74d77055dd895c60ee6b07d583c3fe6db2fc70cc8ac5a72fa9d67acb7814df1409be26e5afd24dd9658a0aca8be4ef9bbb9230d"}}}],"blockstakeoutputs":[{"value":"3000","condition":{"type":1,"data":{"unlockhash":"015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"}}}],"minerfees":null}},"coininputoutputs":null,"coinoutputids":null,"coinoutputunlockhashes":null,"blockstakeinputoutputs":[{"value":"3000","condition":{"type":1,"data":{"unlockhash":"015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"}},"unlockhash":"015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"}],"blockstakeoutputids":["ad28a30a1846d1773070ca1ab0959344673402d211403b016bcdee6e85ed6ead"],"blockstakeunlockhashes":["015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"],"unconfirmed":false}],"rawblock":{"parentid":"4df6fa9d77b675b1562740d602f42fa45a9f3d9458a2fa81959acc631db1c05e","timestamp":1549711355,"pobsindexes":{"BlockHeight":17825,"TransactionIndex":0,"OutputIndex":0},"minerpayouts":[{"value":"10000000000","unlockhash":"015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"}],"transactions":[{"version":1,"data":{"coininputs":null,"blockstakeinputs":[{"parentid":"efebc1649846007eacab3d119cd42daed8a240da8f9ebd31f2472df442467adb","fulfillment":{"type":1,"data":{"publickey":"ed25519:d285f92d6d449d9abb27f4c6cf82713cec0696d62b8c123f1627e054dc6d7780","signature":"28012952f77113862a48698af74d77055dd895c60ee6b07d583c3fe6db2fc70cc8ac5a72fa9d67acb7814df1409be26e5afd24dd9658a0aca8be4ef9bbb9230d"}}}],"blockstakeoutputs":[{"value":"3000","condition":{"type":1,"data":{"unlockhash":"015a080a9259b9d4aaa550e2156f49b1a79a64c7ea463d810d4493e8242e6791584fbdac553e6f"}}}],"minerfees":null}}]},"blockid":"e7113d9220ed1d2b9580db56900275a84cae37f4a05d114f7c2e390e5548a748","difficulty":"16357","estimatedactivebs":"2062","height":17826,"maturitytimestamp":1549711238,"target":[0,4,1,160,229,117,42,154,91,220,26,179,144,72,8,24,83,164,54,113,254,108,169,110,240,86,243,41,58,188,99,94],"totalcoins":"0","arbitrarydatatotalsize":4384,"minerpayoutcount":17915,"transactioncount":18456,"coininputcount":640,"coinoutputcount":1235,"blockstakeinputcount":17826,"blockstakeoutputcount":17827,"minerfeecount":629,"arbitrarydatacount":574},"blocks":null,"transaction":{"id":"0000000000000000000000000000000000000000000000000000000000000000","height":0,"parent":"0000000000000000000000000000000000000000000000000000000000000000","rawtransaction":{"version":0,"data":{"coininputs":[],"minerfees":null}},"coininputoutputs":null,"coinoutputids":null,"coinoutputunlockhashes":null,"blockstakeinputoutputs":null,"blockstakeoutputids":null,"blockstakeunlockhashes":null,"unconfirmed":false},"transactions":null,"multisigaddresses":null,"unconfirmed":false}',
    )

    # and the contract can no longer be refunded
    with pytest.raises(j.clients.tfchain.errors.AtomicSwapContractSpent):
        w.atomicswap.refund("a5e0159688d300ed7a8f2685829192d8dd1266ce6e82a0d04a3bbbb080de30d0")

    # should you verify it at this point, you'll get the same exception
    with pytest.raises(j.clients.tfchain.errors.AtomicSwapContractSpent):
        w.atomicswap.verify("a5e0159688d300ed7a8f2685829192d8dd1266ce6e82a0d04a3bbbb080de30d0")
